# 8 交流-GatedMLAC

在有限带宽情况下通过消息削减学习多智能体交流

论文: [Learning Agent Communication under Limited Bandwidth by Message Pruning](https://arxiv.org/pdf/1912.05304v1.pdf)

**Motivation**其他方法进行交流时往往持续不断地发送消息,这很耗费带宽.
- 本文主要是引入了门控机制(gating mechanism)对消息进行剪枝，进而用有限的通信带宽来传输最有利于智能体协作的消息。
- ==衡量“最有利于智能体协作”的标准是看Q-value是不是足够大，或者说是不是大于一个阈值T==. 
- 并提出了移动平均和设置固定阈值T的两种方法。
- 目标: 削减消息的同时保证性能.甚至能够提升性能.

## 1.Introduction

本文思路:首先集成现有方法,形成一个基础算法 Actor-Critic Message Learner (ACML),该算法也是一直发送消息. 然后将其扩展为Gated-ACML算法.训练时智能体尝试打开门限交流有用信息,如果没用就不去开门.训练好后门控机制就能很好的控制消息.

## 2.Related Work

相关算法:
- CommNet: 在Actor中嵌入一个集中式的消息通道,处理其他所有智能体的消息(通过平均法).
- AMP:这类算法加入attention机制选择特定的消息,但是他们的策略网络使用所有智能体的消息生成一个控制命令,所以所有智能体只能不断发送消息.不灵活.

相近算法: IC3Net and ATOC: 使用门控机制生成一个二进制位,控制是否通信. 不同点在于
- IC3Net and ATOC只适合同质智能体,离散任务; Gated-ACML适合同质或异质的智能体, 连续任务.
- IC3Net: 目标是学习混合任务中**何时**进行大规模通信.允许在一个step中有多个通信周期，并为下一个通信周期生成门控值
- ATOC: 目标是结合智能体动态拓扑结构学习交流.主要通过门控值生成动态的局部通信group(一个agent可以属于多个group)
- Gated-ACML: 学习有限带宽交流问题. 通过全局Q值和一个门限阈值,确定消息是否有益,并用该门控信号削减全局消息.

## 3.Background

**DEC-POMDP.** 本文将历史观测映射到一个动作, 即$$o_i$$是智能体的历史.

**RL**, 本文基于AC架构.

## 4.Method

### 4.1 ACML

|     ![](img/2020-10-19-14-45-03.png)     |
| :--------------------------------------: |
| fig 1. ACML算法.上图 $$M_i$$表示全局消息 |

上图中,每个智能体包括一个ActorNet网络和一个MessageCoordinatorNet, 所有智能体共享CriticNet和MessageCoordinatorNet.消息协调网络类似于CommNet, AMP 和ATOC的通信信道, CriticNet与MADDPG相同. 通过在整个agent团队中共享观察和行动的编码，个体agent可以建立更大的全局感知，推断其他agent的意图，并在决策上进行合作.

该架构解决了MADDPG无通信的局部观察问题,以及AMP和ATOC算法没有CriticNet的不稳定问题.

算法流程

| ![](img/2020-10-19-15-13-21.png) ![](img/2020-10-19-15-13-43.png) |
| :---------------------------------------------------------------: |
|                             框架流程                              |

**训练**,首先智能体基于观察和全局消息生成动作,与环境交互,环境反馈共享奖励 $$r$$. 然后使用经验数据训练.
|                       ![](img/2020-10-19-15-18-13.png)                       |
| :--------------------------------------------------------------------------: |
| 其中, $$L(w),J(\theta_i), w, \theta_i, w^-, \theta^-_i $$意义与单智能体相同. |

对于交流信道的训练,使用链式规则,
| ![](img/2020-10-19-15-21-25.png) |
| :------------------------------: |
|                                  |

由于ACML是端到端可微的，因此可以使用基于上述方程的反向传播来联合优化通信消息和控制策略。

### 4.2 Gated-ACML

为了解决智能体持续不断发送消息,带宽占用太大的问题. **采用一个门控机制来自适应地删除ActorNets之间不太有利的消息**,这样智能体就可以用尽可能少的消息来维护性能.

|          ![](img/2020-10-19-15-44-43.png)           |
| :-------------------------------------------------: |
| fig 2. Gated-ACML. 在每个actorNet中加入一个门控网络 |

(1)每个智能体基于观察生成一个局部消息 $$m_i $$ 和概率 $$p $$. (2)门控网络生成控制信号, $$g=\{0,1\} $$. (3)智能体基于 $$m_i \odot g $$将局部消息发送给MessageCoordinatorNet.

在实践中，如果代理在决策制定时间到来时没有收到消息，它将自动填充零.该设计得到了消息丢失技术的支持,该技术表明,用一定概率的零向量替换某些消息,可以使大规模通信中常见的通信错误和消息冗余更有鲁棒性.

**Training with Auxiliary Task**, 训练概率p. ==由于门控函数 $$g\leftarrow \mathbb{I}(p>0.5) $$不可微分, 所以端到端反向传播不可用(近似梯度,系数正则化,以及其他方法都不成功)==. 为了绕过对不可微指标函数的训练, 我们决定**直接对其输入p进行训练**. 采用辅助任务技术明确地为$$p$$提供训练信号.

本文目标是在保证性能的前提下对消息进行剪枝, 而Q值可以对性能(长期累积回报)进行评价. 本文设计如下辅助任务.

## 讨论
交流可以关注的点:
- 有限带宽
- 私有信息保护
- 局部共享